/*
 * jQuery MultiSelect Plugin 0.1
 * Copyright (c) 2010 Eric Hynds
 *
 * Inspired by Cory S.N. LaViska's implementation, A Beautiful Site (http://abeautifulsite.net/) 2009
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
*/
(function(e){e.fn.extend({multiSelect:function(i){i=e.extend({},l.defaults,i);return this.each(function(){new l(this,i)})}});var l=function(i,g){function m(){var a=h.find("input"),c=k.find("input").filter(":checked"),d="",j=c.length;if(j===0)a.val(g.noneSelected);else{if(g.selectedList)c.each(function(){var n=e(this).parent().text();d=d.length?(d+=", "+n):n});else d=g.selectedText.replace("#",j);a.val(d).attr("title",d)}}var h=$original=e(i),b,k,f="",o=[];f+='<a class="ui-multiselect ui-state-default ui-corner-all"><input readonly="readonly" type="text" value="" /><span class="ui-icon ui-icon-triangle-1-s"></span></a>'; f+='<div class="ui-multiselect-options'+(g.shadow?" ui-multiselect-shadow":"")+' ui-widget ui-widget-content ui-corner-bl ui-corner-br ui-corner-tr">';if(g.showHeader){f+='<div class="ui-widget-header ui-helper-clearfix ui-corner-all ui-multiselect-header">';f+='<ul class="ui-helper-reset">';f+='<li><a class="ui-multiselect-all" href=""><span class="ui-icon ui-icon-check"></span>'+g.checkAllText+"</a></li>";f+='<li><a class="ui-multiselect-none" href=""><span class="ui-icon ui-icon-closethick"></span>'+ g.unCheckAllText+"</a></li>";f+='<li class="ui-multiselect-close"><a href="" class="ui-multiselect-close ui-icon ui-icon-circle-close"></a></li>';f+="</ul>";f+="</div>"}f+='<ul class="ui-multiselect-checkboxes ui-helper-reset">';h.find("option").each(function(){var a=e(this),c=a.val(),d=c.length,j=a.parent();if(j.is("optgroup")){j=j.attr("label");if(e.inArray(j,o)===-1){f+='<li class="ui-multiselect-optgroup-label"><span>'+j+"</span></li>";o.push(j)}}if(d>0){f+=a.parent().is("optgroup")?'<li class="multiSelect-optgroup">': "<li>";f+='<label class="ui-corner-all"><input type="checkbox" name="'+h.attr("name")+'" value="'+c+'"';if(a.is(":selected"))f+=' checked="checked"';f+=" />"+a.html()+"</label></li>"}});f+="</ul></div>";h=h.after(f).next("a.ui-multiselect");b=h.next("div.ui-multiselect-options");$header=b.find("div.ui-multiselect-header");k=b.find("label");h.bind("mouseover mouseout",function(a){e(this)[a.type==="mouseover"?"addClass":"removeClass"]("ui-state-hover")}).bind("focus blur",function(a){e(this)[a.type=== "focus"?"addClass":"removeClass"]("ui-state-focus")}).bind("click",function(){b.trigger(b.is(":hidden")?"open":"close")}).bind("keypress",function(a){switch(a.keyCode){case 27:b.trigger("close");break}}).each(function(){m()});g.showHeader&&$header.find("a").click(function(a){var c=e(a.target);c.hasClass("ui-multiselect-close")?b.trigger("close"):b.trigger("toggleChecked",[c.hasClass("ui-multiselect-all")?true:false]);a.preventDefault()});b.bind({close:function(a,c){c=c||false;if(c===true)e("div.ui-multiselect-options").filter(":visible").fadeOut(g.fadeSpeed).prev("a.ui-multiselect").removeClass("ui-state-active").trigger("mouseout"); else{h.removeClass("ui-state-active").trigger("mouseout");b.fadeOut(g.fadeSpeed)}},open:function(){var a=h.position(),c=b.find("ul:eq(1)"),d;h.addClass("ui-state-active");b.trigger("close",[true]);d=g.position==="middle"?a.top+h.height()/2-b.outerHeight()/2:g.position==="top"?a.top-b.outerHeight():a.top+h.outerHeight();width=h.width()-parseInt(b.css("padding-left"))-parseInt(b.css("padding-right"));k.filter("label:first").trigger("mouseenter");b.css({position:"absolute",top:d+"px",left:a.left+"px", width:width+"px"}).show();c.scrollTop(0);g.maxHeight&&c.css("height",g.maxHeight);g.onOpen.call(b[0])},traverse:function(a,c,d){a=e(c);d=d===38||d===37?true:false;if(!a.parent()[d?"prev":"next"]("li").find("label").trigger("mouseenter").length){a=b.find("ul:eq(1)");b.find("label")[d?"last":"first"]().trigger("mouseover");a.scrollTop(d?a.height():0)}},toggleChecked:function(a,c){a=k.find("input");c?a.attr("checked","checked"):a.removeAttr("checked");m()}});k.bind("mouseenter",function(){k.removeClass("ui-state-hover"); e(this).addClass("ui-state-hover").find("input").focus()}).bind("click",function(a){a.preventDefault();e(this).find("input").trigger("click",[true])}).bind("keyup",function(a){switch(a.keyCode){case 9:b.trigger("close");h.next(":input").focus();break;case 27:b.trigger("close");break;case 38:case 40:case 37:case 39:b.trigger("traverse",[this,a.keyCode]);break;case 13:a.preventDefault();e(this).click();break}}).find("input").bind("click",function(a,c){var d=e(this);c=c||false;a.stopPropagation();if(c){a.preventDefault(); d.is(":checked")?d.removeAttr("checked"):d.attr("checked","checked")}g.onCheck.call(d[0]);m()});e.fn.bgiframe&&b.bgiframe();$original.remove();return b};e(document).bind("click",function(i){i=e(i.target);!i.closest("div.ui-multiselect-options").length&&!i.parent().hasClass("ui-multiselect")&&e("div.ui-multiselect-options").trigger("close",[true])});l.defaults={showHeader:true,maxHeight:175,checkAllText:"Check all",unCheckAllText:"Uncheck all",noneSelected:"Select options",selectedList:false,selectedText:"# selected", position:"bottom",shadow:false,fadeSpeed:200,onCheck:function(){},onOpen:function(){}}})(jQuery);
